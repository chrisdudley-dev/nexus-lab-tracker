#!/usr/bin/env bash
set -euo pipefail

branch="$(git rev-parse --abbrev-ref HEAD)"
if [[ "$branch" == "main" || "$branch" == "master" ]]; then
  echo "ERROR: Refusing to push directly from $branch." >&2
  echo "Make a branch + PR instead." >&2
  exit 2
fi

# Optional: run regress gate before any push
if [[ -x ./scripts/regress_core.sh ]]; then
  ./scripts/regress_core.sh >/dev/null
fi
